<!DOCTYPE html>
<html lang="es" class="cuenta-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingresar su cuenta</title>
    <link rel="stylesheet" href="styles.css">
</head>
<style>
html, body{
  margin: 0;
  background: linear-gradient(140deg, #00218f, #285aff, #72AAFF);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-content: center;
}
</style>

<body>
  <div class="container-seccion">
    <div class="titulo">
      <h1>Systemsware</h1>
    </div>
    <form class="cuadro-azul" id="loginForm">
      <p class="subtitulo">Ingresar a su cuenta</p>
      <p class="descripcion">Ingrese sus datos para continuar.</p>
      <div class="barra">
        <label class="etiqueta" for="correo">Correo electrónico</label>
        <input type="email" id="correo" placeholder="Ingresa tu correo">
        <span class="error" id="error-correo"></span>
      </div>
      <div class="barra">
        <label class="etiqueta" for="contrasena">Contraseña</label>  
        <input type="password" id="contrasena" placeholder="Ingresa tu contraseña">
        <span class="error" id="error-contrasena"></span>
      </div>
        <a href="recuperar.html" class="olvidar">¿Olvidaste tu contraseña?</a>
        <a href="registrar cuenta.html" class="olvidar">¿No tienes cuenta?</a>
      <div class="boton-cuenta">
        <button type="submit">Iniciar Cuenta</button>
      </div>
    </form>
  </div>

<script>
document.getElementById("loginForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const correo = document.getElementById("correo").value.trim();
  const contrasena = document.getElementById("contrasena").value.trim();

  const errorCorreo = document.getElementById("error-correo");
  const errorContrasena = document.getElementById("error-contrasena");

  let valido = true;

  errorCorreo.textContent = "";
  errorContrasena.textContent = "";

  const regexCorreo = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if (correo === "") {
    errorCorreo.textContent = "El correo es obligatorio.";
    valido = false;
  } else if (!regexCorreo.test(correo)) {
    errorCorreo.textContent = "Correo no válido.";
    valido = false;
  }

  if (contrasena === "") {
    errorContrasena.textContent = "La contraseña es obligatoria.";
    valido = false;
  } else if (contrasena.length < 6) {
    errorContrasena.textContent = "Mínimo 6 caracteres.";
    valido = false;
  }

  if (valido) {
      fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ correo, contrasena })
      })
      .then(r => r.json())
      .then(data => {
        if (data.ok) {
          localStorage.setItem('token', data.token);
          window.location.href = 'servicio.html';
        } else {
          alert(data.error || 'Credenciales inválidas');
        }
      })
      .catch(err => {
        console.error(err);
        alert('Error de red');
      });
  }
});
</script>
</body>
</html>